# Layer 3 (Paragraph Level) Sub-Step System Design
# ç¬¬3å±‚ï¼ˆæ®µè½çº§ï¼‰å­æ­¥éª¤ç³»ç»Ÿè®¾è®¡

> Version: 1.0
> Date: 2026-01-07
> Purpose: Design comprehensive sub-step workflow for paragraph-level De-AIGC processing
> ç›®çš„ï¼šè®¾è®¡æ®µè½çº§De-AIGCå¤„ç†çš„å®Œæ•´å­æ­¥éª¤å·¥ä½œæµç¨‹

---

## ä¸€ã€è®¾è®¡æ¦‚è¿° | Design Overview

### 1.1 å±‚çº§å®šä½ | Layer Positioning

```
Layer 5: Document (æ–‡ç« å±‚)     â†’ Step 1.x series âœ… å·²è®¾è®¡
Layer 4: Section (ç« èŠ‚å±‚)      â†’ Step 2.x series âœ… å·²å®ç°
Layer 3: Paragraph (æ®µè½å±‚)    â†’ Step 3.x series ğŸ“‹ æœ¬æ–‡æ¡£è®¾è®¡
Layer 2: Sentence (å¥å­å±‚)     â†’ Step 4.x series
Layer 1: Lexical (è¯æ±‡å±‚)      â†’ Step 5.x series
```

### 1.2 Layer 3 æ ¸å¿ƒèŒè´£ | Core Responsibilities

| èŒè´£ Responsibility | è¯´æ˜ Description |
|-------------------|------------------|
| **æ®µè½è¯†åˆ«ä¸åˆ†å‰²** | æ­£ç¡®è¯†åˆ«æ®µè½è¾¹ç•Œï¼Œè¿‡æ»¤éæ­£æ–‡å†…å®¹ |
| **Paragraph Identification** | Correctly identify paragraph boundaries, filter non-body content |
| **æ®µè½è§’è‰²æ ‡æ³¨** | è¯†åˆ«æ¯ä¸ªæ®µè½çš„åŠŸèƒ½è§’è‰² |
| **Role Labeling** | Identify functional role of each paragraph |
| **å†…éƒ¨è¿è´¯æ€§æ£€æµ‹** | æ£€æµ‹æ®µè½å†…å¥å­é—´çš„é€»è¾‘å…³ç³» |
| **Internal Coherence** | Detect logical relationships between sentences within paragraph |
| **é”šç‚¹å¯†åº¦åˆ†æ** | æ£€æµ‹è¯æ®å¯†åº¦ï¼Œè¯†åˆ«AIå¡«å……ç‰© |
| **Anchor Density** | Detect evidence density, identify AI filler content |
| **å¥é•¿åˆ†å¸ƒåˆ†æ** | æ£€æµ‹æ®µè½å†…å¥å­é•¿åº¦çš„å˜åŒ–æ¨¡å¼ |
| **Sentence Length Distribution** | Detect sentence length variation patterns within paragraph |
| **è¿‡æ¸¡è¿è´¯æ€§æ£€æµ‹** | æ£€æµ‹æ®µè½é—´çš„è¿‡æ¸¡è´¨é‡ |
| **Transition Coherence** | Detect transition quality between paragraphs |

### 1.3 ä¸ç›¸é‚»å±‚çš„å…³ç³» | Relationship with Adjacent Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Layer 4 (Section)                             â”‚
â”‚  â”œâ”€â”€ ä¼ å…¥: sections[], section_roles[]                              â”‚
â”‚  â””â”€â”€ ä¼ å…¥: section_boundaries, section_order_issues                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Layer 3 (Paragraph)                            â”‚
â”‚  â”œâ”€â”€ æ¥æ”¶: sections[], section_roles[]                               â”‚
â”‚  â”œâ”€â”€ åˆ†æ: paragraphs[], paragraph_roles[], coherence[], anchors[]   â”‚
â”‚  â””â”€â”€ ä¼ å‡º: paragraph_context â†’ Layer 2                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Layer 2 (Sentence)                            â”‚
â”‚  â”œâ”€â”€ æ¥æ”¶: paragraph_context (roles, coherence, anchors)            â”‚
â”‚  â””â”€â”€ åˆ†æ: sentences[] with paragraph context                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ£€æµ‹èƒ½åŠ›æ±‡æ€» | Detection Capabilities Summary

### 2.1 å·²æœ‰æ£€æµ‹å™¨ | Existing Detectors

| æ£€æµ‹å™¨ Detector | æ–‡ä»¶ä½ç½® File | çŠ¶æ€ Status | ç”¨é€” Purpose |
|----------------|--------------|-------------|--------------|
| ParagraphLogicAnalyzer | `paragraph_logic.py` | âœ… å·²é›†æˆ | æ®µè½å†…é€»è¾‘ç»“æ„æ£€æµ‹ |
| AnchorDensityAnalyzer | `anchor_density.py` | âœ… å·²é›†æˆ | é”šç‚¹å¯†åº¦/å¹»è§‰é£é™©æ£€æµ‹ |
| SentenceSegmenter | `segmenter.py` | âœ… å·²é›†æˆ | åˆ†å¥ä¸å†…å®¹ç±»å‹è¯†åˆ« |
| TransitionAnalyzer | `transition.py` | âœ… å·²é›†æˆ | æ®µè½è¿‡æ¸¡åˆ†æ |

### 2.2 æ£€æµ‹ç»´åº¦ä¸æŒ‡æ ‡ | Detection Dimensions & Metrics

#### 2.2.1 æ®µè½è§’è‰²æ£€æµ‹ | Paragraph Role Detection

| è§’è‰²ç±»å‹ Role Type | è‹±æ–‡ English | ç‰¹å¾ Characteristics |
|------------------|--------------|---------------------|
| å¼•è¨€ | introduction | èƒŒæ™¯ä»‹ç»ã€ç ”ç©¶ç›®çš„ã€ä¸»é¢˜å¼•å…¥ |
| èƒŒæ™¯ | background | é¢†åŸŸèƒŒæ™¯ã€å·²æœ‰ç ”ç©¶ã€çŸ¥è¯†é“ºå« |
| æ–¹æ³• | methodology | å®éªŒè®¾è®¡ã€æ•°æ®æ”¶é›†ã€æŠ€æœ¯æ–¹æ³• |
| ç»“æœ | results | æ•°æ®å±•ç¤ºã€å®éªŒç»“æœã€å‘ç°æè¿° |
| è®¨è®º | discussion | ç»“æœè§£é‡Šã€æ„ä¹‰åˆ†æã€å±€é™æ€§ |
| ç»“è®º | conclusion | æ€»ç»“å½’çº³ã€æœªæ¥å±•æœ› |
| è¿‡æ¸¡ | transition | ç« èŠ‚è¿æ¥ã€è¯é¢˜è½¬æ¢ |
| æ­£æ–‡ | body | é€šç”¨æ­£æ–‡æ®µè½ |

#### 2.2.2 å†…éƒ¨è¿è´¯æ€§æŒ‡æ ‡ | Internal Coherence Metrics

| æŒ‡æ ‡ Metric | é˜ˆå€¼ Threshold | AIç‰¹å¾ AI-like | äººç±»ç‰¹å¾ Human-like |
|------------|----------------|----------------|---------------------|
| ä¸»è¯­å¤šæ ·æ€§ Subject Diversity | < 0.4 | é‡å¤ä¸»è¯­ (The X... The X...) | å¤šæ ·åŒ–ä¸»è¯­ |
| å¥é•¿å˜å¼‚ç³»æ•° Length CV | < 0.30 | å‡åŒ€å¥é•¿ | å‚å·®å¥é•¿ (CV > 0.40) |
| è¿æ¥è¯å¯†åº¦ Connector Density | > 0.5 | è¿‡å¤šæ˜¾æ€§è¿æ¥è¯ | é€‚åº¦æˆ–éšæ€§è¿æ¥ |
| é€»è¾‘ç»“æ„ç±»å‹ Logic Structure | linear | çº¿æ€§å åŠ  | å±‚æ¬¡ã€å›æº¯ã€å¯¹æ¯” |
| ç¬¬ä¸€äººç§°æ¯”ä¾‹ First Person Ratio | > 0.6 | We/Ourè¿‡åº¦ä½¿ç”¨ | å¹³è¡¡ä½¿ç”¨ |

#### 2.2.3 é”šç‚¹å¯†åº¦æŒ‡æ ‡ | Anchor Density Metrics

| å¯†åº¦èŒƒå›´ (æ¯100è¯) | é£é™©ç­‰çº§ | è¯´æ˜ |
|------------------|---------|------|
| < 5.0 | é«˜é£é™© High | å¯èƒ½æ˜¯AIå¡«å……ç‰© Possible AI filler |
| 5.0 - 10.0 | ä¸­ç­‰é£é™© Medium | éœ€è¦æ›´å¤šå…·ä½“è¯æ® |
| > 10.0 | ä½é£é™© Low | å†…å®¹æœ‰å®è´¨æ€§ |

#### 2.2.4 æ®µå†…å¥é•¿åˆ†å¸ƒæŒ‡æ ‡ | Sentence Length Distribution

| æŒ‡æ ‡ Metric | é˜ˆå€¼ Threshold | è¯´æ˜ Description |
|------------|----------------|------------------|
| æ®µå†…CV | < 0.25 | è¿‡äºå‡åŒ€ï¼ŒAIç‰¹å¾ |
| ç›®æ ‡CV | â‰¥ 0.35 | äººç±»å†™ä½œçš„è‡ªç„¶å˜åŒ– |
| Burstiness | < 0.3 | ä½çªå‘æ€§ = AIç‰¹å¾ |

---

## ä¸‰ã€å­æ­¥éª¤è®¾è®¡æ–¹æ¡ˆ | Sub-Step Design Proposal

### 3.0 æ‰§è¡Œæµç¨‹å›¾ | Execution Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Layer 3: Paragraph Level Analysis                         â”‚
â”‚                    æ®µè½çº§åˆ†æï¼ˆåŸºäºä¸Šå±‚Sectionä¸Šä¸‹æ–‡ï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Step 3.0: æ®µè½è¯†åˆ«ä¸åˆ†å‰² (Paragraph Identification & Segmentation) â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ æ¥æ”¶Sectionä¸Šä¸‹æ–‡ Receive section context from Layer 4        â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ æ­£ç¡®è¯†åˆ«æ®µè½è¾¹ç•Œ Identify paragraph boundaries                â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ è¿‡æ»¤éæ­£æ–‡å†…å®¹ Filter non-body content (headers, keywords)    â”‚     â”‚
â”‚  â”‚  â””â”€â”€ æ®µè½ä¸Sectionæ˜ å°„ Map paragraphs to sections                  â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  ä¾èµ–æ£€æµ‹å™¨ï¼šSentenceSegmenter (content type detection)             â”‚     â”‚
â”‚  â”‚  è¾“å‡ºï¼šparagraphs[] + paragraph_section_map                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                    â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Step 3.1: æ®µè½è§’è‰²è¯†åˆ« (Paragraph Role Detection)                  â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ è¯†åˆ«æ¯ä¸ªæ®µè½çš„åŠŸèƒ½è§’è‰² Identify functional role                â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ æ£€æµ‹è§’è‰²åˆ†å¸ƒå¼‚å¸¸ Detect role distribution anomalies            â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ æ£€æµ‹åŒè´¨åŒ–æ¨¡å¼ Detect homogeneous patterns                     â”‚     â”‚
â”‚  â”‚  â””â”€â”€ ä¸Sectionè§’è‰²å¯¹æ¯”éªŒè¯ Cross-validate with section roles        â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  æ£€æµ‹é¡¹ï¼šè§’è‰²è¯†åˆ«ã€è§’è‰²åˆ†å¸ƒå‡åŒ€æ€§ã€è§’è‰²è¿‡æ¸¡ç¼ºå¤±                       â”‚     â”‚
â”‚  â”‚  æ£€æµ‹å™¨ï¼šLLM Role Classifier + Rule-based patterns                  â”‚     â”‚
â”‚  â”‚  è¾“å‡ºï¼šparagraph_roles[] + role_distribution_issues[]               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                    â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Step 3.2: æ®µè½å†…éƒ¨è¿è´¯æ€§æ£€æµ‹ (Internal Coherence Analysis)         â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ ä¸»è¯­å¤šæ ·æ€§åˆ†æ Subject diversity analysis                      â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ é€»è¾‘ç»“æ„æ£€æµ‹ Logic structure detection                         â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ è¿æ¥è¯å¯†åº¦åˆ†æ Connector density analysis                      â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ ç¬¬ä¸€äººç§°ä½¿ç”¨ç‡ First-person usage ratio                        â”‚     â”‚
â”‚  â”‚  â””â”€â”€ å¼•ç”¨æ¨¡å¼æ£€æµ‹ Citation pattern detection                        â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  æ£€æµ‹é¡¹ï¼šçº¿æ€§ç»“æ„ã€ä¸»è¯­é‡å¤ã€è¿æ¥è¯å †ç Œã€å¼•ç”¨å †ç Œ                     â”‚     â”‚
â”‚  â”‚  æ£€æµ‹å™¨ï¼šParagraphLogicAnalyzer (rule-based)                        â”‚     â”‚
â”‚  â”‚  è¾“å‡ºï¼šcoherence_scores[] + coherence_issues[]                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                    â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Step 3.3: é”šç‚¹å¯†åº¦åˆ†æ (Anchor Density Analysis)                   â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ 13ç±»å­¦æœ¯é”šç‚¹æ£€æµ‹ Detect 13 types of academic anchors           â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ è®¡ç®—æ®µè½é”šç‚¹å¯†åº¦ Calculate anchor density per paragraph        â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ å¹»è§‰é£é™©è¯„ä¼° Hallucination risk assessment                     â”‚     â”‚
â”‚  â”‚  â””â”€â”€ é”šç‚¹ç±»å‹åˆ†å¸ƒåˆ†æ Anchor type distribution analysis             â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  æ£€æµ‹é¡¹ï¼šä½é”šç‚¹å¯†åº¦ã€é”šç‚¹åˆ†å¸ƒä¸å‡ã€å¯èƒ½çš„AIå¡«å……æ®µè½                   â”‚     â”‚
â”‚  â”‚  æ£€æµ‹å™¨ï¼šAnchorDensityAnalyzer (rule-based)                         â”‚     â”‚
â”‚  â”‚  è¾“å‡ºï¼šanchor_densities[] + high_risk_paragraphs[]                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                    â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Step 3.4: æ®µå†…å¥é•¿åˆ†å¸ƒåˆ†æ (Sentence Length Distribution)          â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ è®¡ç®—æ®µå†…å¥é•¿å˜å¼‚ç³»æ•° Calculate within-paragraph length CV      â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ çªå‘æ€§åˆ†æ Burstiness analysis                                 â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ è¯†åˆ«å•è°ƒé•¿åº¦æ¨¡å¼ Identify monotonous length patterns           â”‚     â”‚
â”‚  â”‚  â””â”€â”€ å¥å­èŠ‚å¥åˆ†æ Sentence rhythm analysis                          â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  æ£€æµ‹é¡¹ï¼šå¥é•¿è¿‡äºå‡åŒ€ã€ä½çªå‘æ€§ã€èŠ‚å¥å•è°ƒ                             â”‚     â”‚
â”‚  â”‚  æ£€æµ‹å™¨ï¼šStatistical analysis + BurstinessAnalyzer                  â”‚     â”‚
â”‚  â”‚  è¾“å‡ºï¼šsentence_length_cvs[] + low_burstiness_paragraphs[]          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                    â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Step 3.5: æ®µè½é—´è¿‡æ¸¡æ£€æµ‹ (Paragraph Transition Analysis)           â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ ç›¸é‚»æ®µè½è¡”æ¥åˆ†æ Adjacent paragraph transition analysis        â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ æ˜¾æ€§è¿æ¥è¯æ£€æµ‹ Explicit connector detection                    â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ è¯­ä¹‰å›å£°æ£€æµ‹ Semantic echo detection                           â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ è¿‡æ¸¡å…¬å¼åŒ–æ£€æµ‹ Formulaic transition detection                  â”‚     â”‚
â”‚  â”‚  â””â”€â”€ æä¾›è¯­ä¹‰æ¡¥æ¥å»ºè®® Provide semantic bridging suggestions          â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  æ£€æµ‹é¡¹ï¼šæ˜¾æ€§è¿æ¥è¯è¿‡å¤šã€è¿‡åº¦å¹³æ»‘ã€çªå…€è¿‡æ¸¡ã€é‡å¤å¼€å¤´                  â”‚     â”‚
â”‚  â”‚  æ£€æµ‹å™¨ï¼šTransitionAnalyzer + LLM suggestions                       â”‚     â”‚
â”‚  â”‚  è¾“å‡ºï¼štransition_issues[] + transition_suggestions[]               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                    â†“                                         â”‚
â”‚                     ä¼ é€’æ®µè½ä¸Šä¸‹æ–‡åˆ° Layer 2 (Sentence)                      â”‚
â”‚                     Pass paragraph context to Layer 2                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€å„å­æ­¥éª¤è¯¦ç»†è®¾è®¡ | Detailed Design for Each Sub-Step

### Step 3.0: æ®µè½è¯†åˆ«ä¸åˆ†å‰² (Paragraph Identification & Segmentation)

**ç›®çš„ Purpose**ï¼šä½œä¸ºLayer 3çš„åŸºç¡€æ­¥éª¤ï¼Œæ­£ç¡®è¯†åˆ«å’Œåˆ†å‰²æ®µè½ï¼Œä¸ºåç»­åˆ†ææä¾›åŸºç¡€æ•°æ®ã€‚

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
| åŠŸèƒ½ Function | è¯´æ˜ Description |
|--------------|------------------|
| æ®µè½è¾¹ç•Œè¯†åˆ« | æ ¹æ®ç©ºè¡Œã€ç¼©è¿›ç­‰è¯†åˆ«æ®µè½è¾¹ç•Œ |
| éæ­£æ–‡è¿‡æ»¤ | è¿‡æ»¤æ ‡é¢˜ã€å…³é”®è¯ã€è¡¨å¤´ã€å›¾æ³¨ç­‰éæ­£æ–‡å†…å®¹ |
| Sectionæ˜ å°„ | å°†æ®µè½æ˜ å°„åˆ°Layer 4ä¼ å…¥çš„ç« èŠ‚ç»“æ„ |
| æ®µè½å…ƒæ•°æ®æå– | æå–æ®µè½ä½ç½®ã€è¯æ•°ã€å¥æ•°ç­‰åŸºæœ¬ä¿¡æ¯ |

**è¾“å…¥æ•°æ®ç»“æ„**ï¼š
```python
class ParagraphSegmentationRequest(BaseModel):
    document_text: str
    session_id: Optional[str]
    section_context: Optional[Dict]  # From Layer 4
        # sections: List[SectionInfo]
        # section_roles: List[str]
```

**è¾“å‡ºæ•°æ®ç»“æ„**ï¼š
```python
class ParagraphSegmentationResponse(BaseModel):
    paragraphs: List[str]                    # è¿‡æ»¤åçš„æ®µè½æ–‡æœ¬åˆ—è¡¨
    paragraph_count: int                     # æ®µè½æ€»æ•°
    paragraph_section_map: List[int]         # æ¯ä¸ªæ®µè½å¯¹åº”çš„Sectionç´¢å¼•
    paragraph_metadata: List[ParagraphMeta]  # æ®µè½å…ƒæ•°æ®
    filtered_count: int                      # è¢«è¿‡æ»¤çš„éæ­£æ–‡æ®µè½æ•°
    risk_level: str                          # low/medium/high
    recommendations: List[str]               # å»ºè®®åˆ—è¡¨
    recommendations_zh: List[str]

class ParagraphMeta(BaseModel):
    index: int
    word_count: int
    sentence_count: int
    start_position: int
    end_position: int
    section_index: int
```

**ç”¨æˆ·ç•Œé¢è®¾è®¡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3.0: æ®µè½è¯†åˆ«ä¸åˆ†å‰² Paragraph Identification               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¯†åˆ«ç»“æœ Identification Results:                                 â”‚
â”‚                                                                  â”‚
â”‚ ğŸ“„ æ®µè½æ€»æ•°: 12   |  å·²è¿‡æ»¤: 3 (æ ‡é¢˜ã€å…³é”®è¯ç­‰)                  â”‚
â”‚                                                                  â”‚
â”‚ ç« èŠ‚åˆ†å¸ƒ Section Distribution:                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Section 1 (Introduction):  2 paragraphs  [â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]       â”‚ â”‚
â”‚ â”‚ Section 2 (Methodology):   3 paragraphs  [â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘]       â”‚ â”‚
â”‚ â”‚ Section 3 (Results):       4 paragraphs  [â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘]       â”‚ â”‚
â”‚ â”‚ Section 4 (Discussion):    2 paragraphs  [â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]       â”‚ â”‚
â”‚ â”‚ Section 5 (Conclusion):    1 paragraph   [â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ æ®µè½åˆ—è¡¨é¢„è§ˆ Paragraph List Preview:                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Para 1 (Intro) â”‚ 85 words â”‚ 4 sentences â”‚ [å±•å¼€]            â”‚ â”‚
â”‚ â”‚ Para 2 (Intro) â”‚ 120 words â”‚ 6 sentences â”‚ [å±•å¼€]           â”‚ â”‚
â”‚ â”‚ Para 3 (Method)â”‚ 95 words â”‚ 5 sentences â”‚ [å±•å¼€]            â”‚ â”‚
â”‚ â”‚ ...                                                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ [ç¡®è®¤å¹¶ç»§ç»­ â†’]                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Step 3.1: æ®µè½è§’è‰²è¯†åˆ« (Paragraph Role Detection)

**ç›®çš„ Purpose**ï¼šè¯†åˆ«æ¯ä¸ªæ®µè½çš„åŠŸèƒ½è§’è‰²ï¼Œæ£€æµ‹è§’è‰²åˆ†å¸ƒå¼‚å¸¸å’ŒåŒè´¨åŒ–æ¨¡å¼ã€‚

**æ£€æµ‹é¡¹**ï¼š
| æ£€æµ‹é¡¹ Detection | è§¦å‘æ¡ä»¶ Trigger | é£é™©ç­‰çº§ Risk |
|-----------------|-----------------|---------------|
| è§’è‰²åˆ†å¸ƒå‡åŒ€ Role Uniformity | æ‰€æœ‰æ®µè½è§’è‰²ç›¸åŒæˆ–ç›¸ä¼¼ | High |
| ç¼ºå°‘è¿‡æ¸¡æ®µè½ Missing Transition | è§’è‰²çªå˜ä½†æ— è¿‡æ¸¡æ®µè½ | Medium |
| è§’è‰²ä¸Sectionä¸åŒ¹é… Role-Section Mismatch | æ®µè½è§’è‰²ä¸æ‰€å±Sectionè§’è‰²ä¸ä¸€è‡´ | Medium |
| åŠŸèƒ½æ®µè½è¿‡å°‘ Functional Deficiency | ç¼ºå°‘å…³é”®åŠŸèƒ½æ®µè½ï¼ˆå¦‚èƒŒæ™¯ã€æ–¹æ³•ï¼‰ | Low |

**æ®µè½è§’è‰²ç±»å‹**ï¼š
| è§’è‰² Role | è‹±æ–‡ English | å…³é”®è¯/ç‰¹å¾ Keywords/Features |
|----------|--------------|------------------------------|
| å¼•è¨€ | introduction | research, study, this paper, aim, purpose |
| èƒŒæ™¯ | background | previously, prior studies, existing research |
| æ–¹æ³• | methodology | method, approach, procedure, experiment, data collection |
| ç»“æœ | results | found, results, data, showed, demonstrated |
| è®¨è®º | discussion | suggests, implies, consistent with, contrary to |
| ç»“è®º | conclusion | in conclusion, therefore, summary, future |
| è¿‡æ¸¡ | transition | having discussed, turning to, next, now |

**è¾“å‡ºæ•°æ®ç»“æ„**ï¼š
```python
class ParagraphRoleResponse(BaseModel):
    paragraph_roles: List[ParagraphRoleInfo]
    role_distribution: Dict[str, int]          # è§’è‰²åˆ†å¸ƒç»Ÿè®¡
    uniformity_score: float                    # 0-1, è¶Šé«˜è¶Šå‡åŒ€(AIç‰¹å¾)
    missing_roles: List[str]                   # ç¼ºå¤±çš„å…³é”®è§’è‰²
    role_transition_issues: List[RoleIssue]    # è§’è‰²è¿‡æ¸¡é—®é¢˜
    risk_level: str
    recommendations: List[str]
    recommendations_zh: List[str]

class ParagraphRoleInfo(BaseModel):
    paragraph_index: int
    role: str
    confidence: float                          # 0-1
    section_index: int
    role_matches_section: bool                 # æ˜¯å¦ä¸Sectionè§’è‰²åŒ¹é…
    keywords_found: List[str]                  # æ£€æµ‹åˆ°çš„å…³é”®è¯
```

**ç”¨æˆ·ç•Œé¢è®¾è®¡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3.1: æ®µè½è§’è‰²è¯†åˆ« Paragraph Role Detection                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è§’è‰²åˆ†å¸ƒåˆ†æ Role Distribution Analysis:                         â”‚
â”‚                                                                  â”‚
â”‚ å‡åŒ€æ€§åˆ†æ•°: 0.75/1.0 [ä¸­é£é™©] âš ï¸                                 â”‚
â”‚ Uniformity Score: 0.75/1.0 [Medium Risk]                        â”‚
â”‚                                                                  â”‚
â”‚ è§’è‰²åˆ†å¸ƒå¯è§†åŒ– Role Distribution:                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Introduction  â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  2 (17%)                           â”‚ â”‚
â”‚ â”‚ Background    â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  1 (8%)                            â”‚ â”‚
â”‚ â”‚ Methodology   â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘  3 (25%)                           â”‚ â”‚
â”‚ â”‚ Results       â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘  4 (33%)                           â”‚ â”‚
â”‚ â”‚ Discussion    â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  2 (17%)                           â”‚ â”‚
â”‚ â”‚ Conclusion    â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  0 (0%)  âš ï¸ ç¼ºå¤±                    â”‚ â”‚
â”‚ â”‚ Transition    â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  0 (0%)  âš ï¸ ç¼ºå¤±                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ âš ï¸ æ£€æµ‹åˆ°çš„é—®é¢˜ Detected Issues:                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. ç¼ºå°‘ç»“è®ºæ®µè½ Missing conclusion paragraph                 â”‚ â”‚
â”‚ â”‚    å»ºè®®: æ·»åŠ æ€»ç»“æ€§æ®µè½                                      â”‚ â”‚
â”‚ â”‚    [AIåˆ†æå»ºè®®] [æ‰‹åŠ¨å¤„ç†] [è·³è¿‡]                            â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ 2. ç¼ºå°‘è¿‡æ¸¡æ®µè½ No transition paragraphs                    â”‚ â”‚
â”‚ â”‚    å»ºè®®: åœ¨Sectioné—´æ·»åŠ è¿‡æ¸¡æ®µè½                             â”‚ â”‚
â”‚ â”‚    [AIåˆ†æå»ºè®®] [æ‰‹åŠ¨å¤„ç†] [è·³è¿‡]                            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ [ä¸Šä¸€æ­¥ â†] [ç¡®è®¤å¹¶ç»§ç»­ â†’]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Step 3.2: æ®µè½å†…éƒ¨è¿è´¯æ€§æ£€æµ‹ (Internal Coherence Analysis)

**ç›®çš„ Purpose**ï¼šæ£€æµ‹æ®µè½å†…å¥å­é—´çš„é€»è¾‘å…³ç³»ï¼Œè¯†åˆ«AIå¼çš„çº¿æ€§å åŠ ç»“æ„ã€‚

**æ£€æµ‹é¡¹**ï¼š
| æ£€æµ‹é¡¹ Detection | é˜ˆå€¼ Threshold | AIç‰¹å¾è¯´æ˜ |
|-----------------|----------------|-----------|
| çº¿æ€§ç»“æ„ Linear Structure | ç»“æ„ç±»å‹=linear | å¥å­é—´ä»…æœ‰å åŠ å…³ç³» |
| ä¸»è¯­é‡å¤ Subject Repetition | ä¸»è¯­å¤šæ ·æ€§<0.4 | The X... The X... æ¨¡å¼ |
| å¥é•¿å‡åŒ€ Uniform Length | CV<0.30 | å¥å­é•¿åº¦è¿‡äºæ•´é½ |
| è¿æ¥è¯å †ç Œ Connector Stacking | å¯†åº¦>0.5 | Furthermore... Moreover... |
| ç¬¬ä¸€äººç§°è¿‡å¤š First Person Overuse | æ¯”ä¾‹>0.6 | We... We... We... æ¨¡å¼ |
| å¼•ç”¨å †ç Œ Citation Stacking | å¼•ç”¨å¯†åº¦å¼‚å¸¸ | (Smith, 2020) (Jones, 2021)... |

**é€»è¾‘ç»“æ„ç±»å‹**ï¼š
```
AIå¼ (é«˜é£é™©):
- LINEAR: A + B + C + D (çº¯å åŠ )
- PARALLEL: A | B | C (å¹¶åˆ—ä½†æ— å±‚æ¬¡)

äººç±»å¼ (ä½é£é™©):
- HIERARCHICAL: A â†’ A' â†’ A'' (å±‚å±‚æ·±å…¥)
- CONTRASTIVE: A â†” B â†’ C (å¯¹æ¯”åç»¼åˆ)
- RECURSIVE: A â†’ B â†’ A' â†’ C (å›æº¯å¼)
```

**è¾“å‡ºæ•°æ®ç»“æ„**ï¼š
```python
class CoherenceAnalysisResponse(BaseModel):
    paragraph_coherence: List[ParagraphCoherence]
    overall_coherence_score: float           # 0-100
    high_risk_paragraphs: List[int]          # é«˜é£é™©æ®µè½ç´¢å¼•
    issues: List[CoherenceIssue]
    risk_level: str
    recommendations: List[str]
    recommendations_zh: List[str]

class ParagraphCoherence(BaseModel):
    paragraph_index: int
    subject_diversity: float                 # 0-1
    length_variation_cv: float               # å¥é•¿å˜å¼‚ç³»æ•°
    logic_structure: str                     # linear/mixed/hierarchical
    connector_density: float                 # 0-1
    first_person_ratio: float                # 0-1
    overall_score: float                     # 0-100
    issues: List[CoherenceIssue]
```

**ç”¨æˆ·ç•Œé¢è®¾è®¡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3.2: æ®µè½å†…éƒ¨è¿è´¯æ€§ Internal Coherence Analysis            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•´ä½“è¿è´¯æ€§åˆ†æ•°: 65/100 [ä¸­é£é™©] âš ï¸                               â”‚
â”‚                                                                  â”‚
â”‚ æ®µè½è¿è´¯æ€§è¯¦æƒ… Paragraph Coherence Details:                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Para â”‚ Subject â”‚ Length â”‚ Logic    â”‚ Connector â”‚ Score      â”‚ â”‚
â”‚ â”‚      â”‚ Divers. â”‚ CV     â”‚ Structureâ”‚ Density   â”‚            â”‚ â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚ â”‚  1   â”‚  0.65   â”‚  0.35  â”‚ mixed    â”‚   0.20    â”‚ 75 âœ…      â”‚ â”‚
â”‚ â”‚  2   â”‚  0.35 âš ï¸â”‚  0.22 âš ï¸â”‚ linear âš ï¸â”‚   0.60 âš ï¸ â”‚ 45 âš ï¸      â”‚ â”‚
â”‚ â”‚  3   â”‚  0.55   â”‚  0.40  â”‚ mixed    â”‚   0.25    â”‚ 70 âœ…      â”‚ â”‚
â”‚ â”‚  4   â”‚  0.30 âš ï¸â”‚  0.18 âš ï¸â”‚ linear âš ï¸â”‚   0.55 âš ï¸ â”‚ 40 âš ï¸      â”‚ â”‚
â”‚ â”‚  5   â”‚  0.70   â”‚  0.45  â”‚ hier.    â”‚   0.15    â”‚ 85 âœ…      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ âš ï¸ é«˜é£é™©æ®µè½: Para 2, Para 4 [ç‚¹å‡»å±•å¼€è¯¦æƒ…]                     â”‚
â”‚                                                                  â”‚
â”‚ æ®µè½2è¯¦ç»†åˆ†æ:                                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ é—®é¢˜: çº¿æ€§å åŠ ç»“æ„ + ä¸»è¯­é‡å¤                                â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ åŸæ–‡é¢„è§ˆ:                                                   â”‚ â”‚
â”‚ â”‚ "The study demonstrates... Furthermore, the study shows...  â”‚ â”‚
â”‚ â”‚  Additionally, the study indicates..."                      â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ æ£€æµ‹åˆ°æ¨¡å¼:                                                 â”‚ â”‚
â”‚ â”‚ â€¢ ä¸»è¯­é‡å¤: "The study" å‡ºç°3æ¬¡ (60%)                       â”‚ â”‚
â”‚ â”‚ â€¢ è¿æ¥è¯å †ç Œ: Furthermore, Additionally                     â”‚ â”‚
â”‚ â”‚ â€¢ é€»è¾‘ç»“æ„: LINEAR (çº¯å åŠ )                                 â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ [AIæ”¹è¿›å»ºè®®] [æ‰‹åŠ¨ç¼–è¾‘] [è·³è¿‡]                              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ [ä¸Šä¸€æ­¥ â†] [ç¡®è®¤å¹¶ç»§ç»­ â†’]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Step 3.3: é”šç‚¹å¯†åº¦åˆ†æ (Anchor Density Analysis)

**ç›®çš„ Purpose**ï¼šæ£€æµ‹æ®µè½ä¸­çš„å­¦æœ¯é”šç‚¹å¯†åº¦ï¼Œè¯†åˆ«å¯èƒ½çš„AIå¡«å……ç‰©ï¼ˆå¹»è§‰é£é™©ï¼‰ã€‚

**13ç±»å­¦æœ¯é”šç‚¹**ï¼š
| ç±»å‹ Type | ç¤ºä¾‹ Example | æƒé‡ Weight |
|-----------|--------------|-------------|
| DECIMAL_NUMBER | 14.2, 3.5 | 1.0 |
| PERCENTAGE | 50%, 14.2% | 1.2 |
| STATISTICAL_VALUE | p < 0.05, r = 0.82 | 1.5 |
| SAMPLE_SIZE | n = 500, N = 1000 | 1.3 |
| CITATION_BRACKET | [1], [2,3] | 1.5 |
| CITATION_AUTHOR | (Smith, 2020) | 1.5 |
| UNIT_MEASUREMENT | 5mL, 20Â°C, 3.5kg | 1.3 |
| CHEMICAL_FORMULA | H2O, CO2, NaCl | 1.2 |
| SPECIFIC_COUNT | 500 samples, 3 groups | 1.4 |
| SCIENTIFIC_NOTATION | 1.5e-3, 2.0Ã—10^6 | 1.3 |
| ACRONYM | ANOVA, CNN, LSTM | 1.0 |
| EQUATION_REF | Eq. 1, Equation (2) | 1.4 |
| FIGURE_TABLE_REF | Fig. 1, Table 2 | 1.4 |

**è¾“å‡ºæ•°æ®ç»“æ„**ï¼š
```python
class AnchorDensityResponse(BaseModel):
    overall_density: float                   # æ¯100è¯é”šç‚¹æ•°
    paragraph_densities: List[ParagraphAnchorInfo]
    high_risk_paragraphs: List[int]          # å¹»è§‰é£é™©æ®µè½
    anchor_type_distribution: Dict[str, int] # é”šç‚¹ç±»å‹åˆ†å¸ƒ
    document_hallucination_risk: str         # low/medium/high
    issues: List[AnchorIssue]
    recommendations: List[str]
    recommendations_zh: List[str]

class ParagraphAnchorInfo(BaseModel):
    paragraph_index: int
    word_count: int
    anchor_count: int
    density: float                           # æ¯100è¯é”šç‚¹æ•°
    has_hallucination_risk: bool
    risk_level: str
    anchor_types: Dict[str, int]             # è¯¥æ®µè½çš„é”šç‚¹ç±»å‹åˆ†å¸ƒ
```

**ç”¨æˆ·ç•Œé¢è®¾è®¡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3.3: é”šç‚¹å¯†åº¦åˆ†æ Anchor Density Analysis                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•´ä½“é”šç‚¹å¯†åº¦: 7.2 / 100è¯ [ä¸­ç­‰]                                 â”‚
â”‚ æ–‡æ¡£å¹»è§‰é£é™©: ä¸­ç­‰ âš ï¸                                            â”‚
â”‚                                                                  â”‚
â”‚ æ®µè½é”šç‚¹å¯†åº¦åˆ†å¸ƒ Paragraph Anchor Density:                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Para â”‚ Words â”‚ Anchors â”‚ Density â”‚ Risk     â”‚ Status       â”‚ â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚ â”‚  1   â”‚  85   â”‚    8    â”‚  9.4    â”‚ Low      â”‚ âœ…           â”‚ â”‚
â”‚ â”‚  2   â”‚  120  â”‚    4    â”‚  3.3    â”‚ High     â”‚ âš ï¸ å¹»è§‰é£é™©   â”‚ â”‚
â”‚ â”‚  3   â”‚  95   â”‚   12    â”‚ 12.6    â”‚ Low      â”‚ âœ…           â”‚ â”‚
â”‚ â”‚  4   â”‚  150  â”‚    3    â”‚  2.0    â”‚ High     â”‚ âš ï¸ å¹»è§‰é£é™©   â”‚ â”‚
â”‚ â”‚  5   â”‚  80   â”‚   11    â”‚ 13.8    â”‚ Low      â”‚ âœ…           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ é”šç‚¹ç±»å‹åˆ†å¸ƒ Anchor Type Distribution:                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â€¢ Citations      â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘  15 (31%)                       â”‚ â”‚
â”‚ â”‚ â€¢ Numbers        â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘  12 (25%)                       â”‚ â”‚
â”‚ â”‚ â€¢ Percentages    â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘   8 (17%)                       â”‚ â”‚
â”‚ â”‚ â€¢ Units          â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   6 (13%)                       â”‚ â”‚
â”‚ â”‚ â€¢ Others         â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   7 (14%)                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ âš ï¸ é«˜é£é™©æ®µè½è¯¦æƒ… (Para 2):                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ é¢„è§ˆ: "The comprehensive landscape of modern agricultural   â”‚ â”‚
â”‚ â”‚ practices underscores the multifaceted nature of            â”‚ â”‚
â”‚ â”‚ sustainable farming..."                                      â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ æ£€æµ‹åˆ°çš„é”šç‚¹: 4ä¸ª (å¯†åº¦: 3.3/100è¯)                          â”‚ â”‚
â”‚ â”‚ â€¢ 0ä¸ªæ•°æ®  â€¢ 0ä¸ªå¼•ç”¨  â€¢ 4ä¸ªå…¶ä»–                             â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ âš ï¸ è­¦å‘Š: æ­¤æ®µè½å¯èƒ½æ˜¯AIå¡«å……ç‰©ï¼Œç¼ºä¹å…·ä½“è¯æ®                  â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ å»ºè®®:                                                       â”‚ â”‚
â”‚ â”‚ â€¢ æ·»åŠ å…·ä½“æ•°æ®ï¼ˆå¦‚: "äº§é‡æå‡14.2%"ï¼‰                        â”‚ â”‚
â”‚ â”‚ â€¢ æ·»åŠ å¼•ç”¨æ”¯æ’‘ï¼ˆå¦‚: "(Smith et al., 2023)"ï¼‰                â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ [AIç”Ÿæˆæ”¹è¿›å»ºè®®] [æ ‡è®°éœ€è¦è¡¥å……] [ä¿æŒåŸæ ·]                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ [ä¸Šä¸€æ­¥ â†] [ç¡®è®¤å¹¶ç»§ç»­ â†’]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Step 3.4: æ®µå†…å¥é•¿åˆ†å¸ƒåˆ†æ (Sentence Length Distribution)

**ç›®çš„ Purpose**ï¼šåˆ†ææ¯ä¸ªæ®µè½å†…å¥å­é•¿åº¦çš„å˜åŒ–æ¨¡å¼ï¼Œæ£€æµ‹AIå¼çš„å‡åŒ€å¥é•¿ã€‚

**æ£€æµ‹é¡¹**ï¼š
| æ£€æµ‹é¡¹ Detection | é˜ˆå€¼ Threshold | AIç‰¹å¾è¯´æ˜ |
|-----------------|----------------|-----------|
| æ®µå†…CVè¿‡ä½ | CV < 0.25 | å¥å­é•¿åº¦è¿‡äºå‡åŒ€ |
| ä½çªå‘æ€§ | Burstiness < 0.3 | ç¼ºä¹é•¿çŸ­å¥äº¤æ›¿ |
| èŠ‚å¥å•è°ƒ | æ— çŸ­å¥(<10è¯)æˆ–æ— é•¿å¥(>30è¯) | ç¼ºä¹èŠ‚å¥å˜åŒ– |

**è¾“å‡ºæ•°æ®ç»“æ„**ï¼š
```python
class SentenceLengthResponse(BaseModel):
    paragraph_lengths: List[ParagraphSentenceLength]
    low_burstiness_paragraphs: List[int]     # ä½çªå‘æ€§æ®µè½
    overall_cv: float                        # å…¨æ–‡å¥é•¿CV
    issues: List[LengthIssue]
    recommendations: List[str]
    recommendations_zh: List[str]

class ParagraphSentenceLength(BaseModel):
    paragraph_index: int
    sentence_count: int
    sentence_lengths: List[int]              # æ¯å¥è¯æ•°
    mean_length: float
    std_length: float
    cv: float                                # å˜å¼‚ç³»æ•°
    burstiness: float
    has_short_sentence: bool                 # æ˜¯å¦æœ‰çŸ­å¥(<10è¯)
    has_long_sentence: bool                  # æ˜¯å¦æœ‰é•¿å¥(>30è¯)
    rhythm_score: float                      # èŠ‚å¥å˜åŒ–åˆ†æ•°
```

**ç”¨æˆ·ç•Œé¢è®¾è®¡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3.4: æ®µå†…å¥é•¿åˆ†å¸ƒ Sentence Length Distribution             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•´ä½“å¥é•¿å˜å¼‚ç³»æ•°: 0.32 [é€‚ä¸­]                                    â”‚
â”‚                                                                  â”‚
â”‚ æ®µè½å¥é•¿åˆ†æ Paragraph Sentence Length Analysis:                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Para â”‚ Sents â”‚ CV    â”‚ Burst. â”‚ Rhythm â”‚ Status            â”‚ â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚ â”‚  1   â”‚   4   â”‚ 0.38  â”‚  0.45  â”‚  Good  â”‚ âœ…                â”‚ â”‚
â”‚ â”‚  2   â”‚   6   â”‚ 0.18 âš ï¸â”‚  0.22 âš ï¸â”‚  Poor  â”‚ âš ï¸ è¿‡äºå‡åŒ€      â”‚ â”‚
â”‚ â”‚  3   â”‚   5   â”‚ 0.42  â”‚  0.52  â”‚  Good  â”‚ âœ…                â”‚ â”‚
â”‚ â”‚  4   â”‚   7   â”‚ 0.15 âš ï¸â”‚  0.18 âš ï¸â”‚  Poor  â”‚ âš ï¸ è¿‡äºå‡åŒ€      â”‚ â”‚
â”‚ â”‚  5   â”‚   4   â”‚ 0.55  â”‚  0.60  â”‚  Good  â”‚ âœ…                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ æ®µè½2å¥é•¿å¯è§†åŒ– (Para 2 Length Visualization):                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ S1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  18è¯                    â”‚ â”‚
â”‚ â”‚ S2: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  20è¯                    â”‚ â”‚
â”‚ â”‚ S3: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  19è¯                    â”‚ â”‚
â”‚ â”‚ S4: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  21è¯                    â”‚ â”‚
â”‚ â”‚ S5: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  17è¯                    â”‚ â”‚
â”‚ â”‚ S6: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  18è¯                    â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ âš ï¸ æ‰€æœ‰å¥å­é•¿åº¦åœ¨17-21è¯ä¹‹é—´ï¼Œè¿‡äºå‡åŒ€                       â”‚ â”‚
â”‚ â”‚ å»ºè®®: æ·»åŠ çŸ­å¥(å¼ºè°ƒ) æˆ– åˆå¹¶ä¸ºé•¿å¤åˆå¥                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ æ”¹è¿›ç­–ç•¥ Improvement Strategies:                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœ‚ï¸ æ‹†åˆ†: å°†å¤æ‚å¥æ‹†åˆ†ä¸ºçŸ­å¥ï¼Œåˆ›é€ èŠ‚å¥å˜åŒ–                    â”‚ â”‚
â”‚ â”‚ ğŸ”— åˆå¹¶: åˆå¹¶ç›¸å…³çŸ­å¥ä¸ºå¤åˆå¥ï¼Œå¢åŠ é•¿å¥                      â”‚ â”‚
â”‚ â”‚ ğŸ“ è¡¥å……: æ·»åŠ å¼ºè°ƒæ€§çŸ­å¥ (8-12è¯)                            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ [ä¸Šä¸€æ­¥ â†] [ç¡®è®¤å¹¶ç»§ç»­ â†’]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Step 3.5: æ®µè½é—´è¿‡æ¸¡æ£€æµ‹ (Paragraph Transition Analysis)

**ç›®çš„ Purpose**ï¼šåˆ†æç›¸é‚»æ®µè½ä¹‹é—´çš„è¡”æ¥è´¨é‡ï¼Œæ£€æµ‹æ˜¾æ€§è¿æ¥è¯è¿‡å¤šæˆ–è¿‡æ¸¡çªå…€çš„é—®é¢˜ã€‚

**æ£€æµ‹é¡¹**ï¼š
| æ£€æµ‹é¡¹ Detection | AIç‰¹å¾è¯´æ˜ |
|-----------------|-----------|
| æ˜¾æ€§è¿æ¥è¯è¿‡å¤š | Furthermore, Moreover ç­‰æ®µé¦–è¿æ¥è¯ |
| è¿‡åº¦å¹³æ»‘è¿‡æ¸¡ | è¿‡æ¸¡å¤ªè‡ªç„¶æµç•…ï¼Œç¼ºä¹åœé¡¿ |
| çªå…€è¿‡æ¸¡ | è¯é¢˜çªå˜ï¼Œç¼ºä¹é€»è¾‘è¿æ¥ |
| é‡å¤å¼€å¤´ | å¤šä¸ªæ®µè½ä½¿ç”¨ç›¸åŒå¼€å¤´æ¨¡å¼ |
| å…¬å¼åŒ–è¿‡æ¸¡ | Firstly... Secondly... Finally... |

**è¿‡æ¸¡ç­–ç•¥ç±»å‹**ï¼š
| ç­–ç•¥ Strategy | è¯´æ˜ Description |
|--------------|------------------|
| SEMANTIC_ECHO | åœ¨ä¸‹æ®µå¼€å¤´è‡ªç„¶å¼•ç”¨ä¸Šæ®µå…³é”®è¯ |
| LOGICAL_HOOK | ç”¨é—®é¢˜æˆ–æ‚¬å¿µå¼•å¯¼åˆ°ä¸‹ä¸€æ®µ |
| RHYTHM_BREAK | ç”¨çŸ­å¥æˆ–è½¬æŠ˜æ‰“æ–­å•è°ƒèŠ‚å¥ |
| THEMATIC_LINK | é€šè¿‡ä¸»é¢˜è¯å»ºç«‹éšæ€§è¿æ¥ |

**è¾“å‡ºæ•°æ®ç»“æ„**ï¼š
```python
class TransitionAnalysisResponse(BaseModel):
    transitions: List[TransitionInfo]
    explicit_connector_count: int            # æ˜¾æ€§è¿æ¥è¯æ•°é‡
    explicit_ratio: float                    # æ˜¾æ€§è¿æ¥è¯æ¯”ä¾‹
    avg_semantic_echo: float                 # å¹³å‡è¯­ä¹‰å›å£°åˆ†æ•°
    issues: List[TransitionIssue]
    suggestions: List[TransitionSuggestion]
    risk_level: str
    recommendations: List[str]
    recommendations_zh: List[str]

class TransitionInfo(BaseModel):
    from_paragraph: int
    to_paragraph: int
    has_explicit_connector: bool
    connector_word: Optional[str]
    semantic_echo_score: float               # è¯­ä¹‰å›å£°åˆ†æ•° 0-1
    transition_quality: str                  # smooth/abrupt/formulaic
    issue: Optional[str]
```

**ç”¨æˆ·ç•Œé¢è®¾è®¡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3.5: æ®µè½é—´è¿‡æ¸¡æ£€æµ‹ Paragraph Transition Analysis          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ˜¾æ€§è¿æ¥è¯æ¯”ä¾‹: 45% [é«˜é£é™©] âš ï¸                                  â”‚
â”‚ å¹³å‡è¯­ä¹‰å›å£°åˆ†æ•°: 0.35 [éœ€æ”¹è¿›]                                  â”‚
â”‚                                                                  â”‚
â”‚ è¿‡æ¸¡ç‚¹åˆ†æ Transition Analysis:                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ From â”‚ To â”‚ Connector    â”‚ Echo  â”‚ Quality   â”‚ Status      â”‚ â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚ â”‚  1   â”‚ 2  â”‚ Furthermore  â”‚ 0.25  â”‚ Formulaic â”‚ âš ï¸          â”‚ â”‚
â”‚ â”‚  2   â”‚ 3  â”‚ Moreover     â”‚ 0.30  â”‚ Formulaic â”‚ âš ï¸          â”‚ â”‚
â”‚ â”‚  3   â”‚ 4  â”‚ -            â”‚ 0.45  â”‚ Smooth    â”‚ âœ…          â”‚ â”‚
â”‚ â”‚  4   â”‚ 5  â”‚ Additionally â”‚ 0.20  â”‚ Formulaic â”‚ âš ï¸          â”‚ â”‚
â”‚ â”‚  5   â”‚ 6  â”‚ -            â”‚ 0.15  â”‚ Abrupt    â”‚ âš ï¸          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ é—®é¢˜è¿‡æ¸¡ç‚¹è¯¦æƒ… (Para 1 â†’ Para 2):                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ä¸Šæ®µç»“å°¾: "...statistical significance p<0.05."             â”‚ â”‚
â”‚ â”‚ ä¸‹æ®µå¼€å¤´: "Furthermore, the results demonstrate..."         â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ é—®é¢˜: æ˜¾æ€§è¿æ¥è¯ "Furthermore" (å…¬å¼åŒ–è¿‡æ¸¡)                  â”‚ â”‚
â”‚ â”‚ å‰æ®µå…³é”®æ¦‚å¿µ: [statistical significance, p-value]           â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ è¯­ä¹‰å›å£°æ›¿æ¢å»ºè®®:                                           â”‚ â”‚
â”‚ â”‚ "This pattern of statistical significance extends to the    â”‚ â”‚
â”‚ â”‚ secondary analysis, where..."                                â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ [åº”ç”¨æ›¿æ¢] [ä¿®æ”¹ååº”ç”¨] [è·³è¿‡]                               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ [æ‰¹é‡å¤„ç†æ‰€æœ‰é—®é¢˜è¿‡æ¸¡] [é€ä¸ªå¤„ç†] [å®Œæˆå¹¶ç»§ç»­ â†’]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€APIç«¯ç‚¹è®¾è®¡ | API Endpoint Design

### 5.1 ç«¯ç‚¹åˆ—è¡¨ | Endpoint List

```python
# Layer 3 Paragraph-level Endpoints

# Step 3.0: Paragraph Identification
POST /api/v1/layer3/step3-0/identify          # æ®µè½è¯†åˆ«ä¸åˆ†å‰²

# Step 3.1: Paragraph Role Detection
POST /api/v1/layer3/step3-1/analyze           # æ®µè½è§’è‰²åˆ†æ
POST /api/v1/layer3/step3-1/update-role       # æ‰‹åŠ¨æ›´æ–°æ®µè½è§’è‰²

# Step 3.2: Internal Coherence
POST /api/v1/layer3/step3-2/analyze           # å†…éƒ¨è¿è´¯æ€§åˆ†æ
POST /api/v1/layer3/step3-2/suggest           # è·å–æ”¹è¿›å»ºè®®

# Step 3.3: Anchor Density
POST /api/v1/layer3/step3-3/analyze           # é”šç‚¹å¯†åº¦åˆ†æ

# Step 3.4: Sentence Length Distribution
POST /api/v1/layer3/step3-4/analyze           # å¥é•¿åˆ†å¸ƒåˆ†æ

# Step 3.5: Paragraph Transition
POST /api/v1/layer3/step3-5/analyze           # è¿‡æ¸¡åˆ†æ
POST /api/v1/layer3/step3-5/suggest           # è¿‡æ¸¡æ”¹è¿›å»ºè®®
POST /api/v1/layer3/step3-5/apply             # åº”ç”¨è¿‡æ¸¡å»ºè®®

# Combined Analysis
POST /api/v1/layer3/analyze                   # å®Œæ•´æ®µè½å±‚åˆ†æ
GET  /api/v1/layer3/context                   # è·å–æ®µè½ä¸Šä¸‹æ–‡(ä¼ é€’ç»™Layer 2)
```

### 5.2 è¯·æ±‚/å“åº”Schemaè®¾è®¡ | Request/Response Schemas

```python
# Common Request Base
class Layer3BaseRequest(BaseModel):
    text: Optional[str]                       # åŸæ–‡ï¼ˆä¸paragraphsäºŒé€‰ä¸€ï¼‰
    paragraphs: Optional[List[str]]           # æ®µè½åˆ—è¡¨
    session_id: Optional[str]                 # ä¼šè¯ID
    section_context: Optional[Dict]           # Layer 4ä¼ å…¥çš„ç« èŠ‚ä¸Šä¸‹æ–‡
    locked_terms: Optional[List[str]]         # é”å®šè¯æ±‡ï¼ˆä»Layer 5ä¼ é€’ï¼‰

# Common Response Base
class Layer3BaseResponse(BaseModel):
    risk_score: int                           # 0-100
    risk_level: str                           # low/medium/high
    issues: List[DetectionIssue]
    recommendations: List[str]
    recommendations_zh: List[str]
    processing_time_ms: int
```

---

## å…­ã€æ£€æµ‹å™¨é›†æˆæ–¹æ¡ˆ | Detector Integration Plan

### 6.1 é›†æˆæ˜ å°„ | Integration Mapping

| å­æ­¥éª¤ Sub-Step | æ£€æµ‹å™¨ Detectors | ç±»å‹ Type |
|----------------|-----------------|-----------|
| Step 3.0 | SentenceSegmenter | Rule-based |
| Step 3.1 | LLM Role Classifier + Keywords | LLM + Rule |
| Step 3.2 | ParagraphLogicAnalyzer | Rule-based |
| Step 3.3 | AnchorDensityAnalyzer | Rule-based |
| Step 3.4 | Statistical CV + BurstinessAnalyzer | Rule-based |
| Step 3.5 | TransitionAnalyzer + LLM | Rule + LLM |

### 6.2 æ•°æ®æµè®¾è®¡ | Data Flow Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•°æ®æµ Data Flow                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ä» Layer 4 æ¥æ”¶ From Layer 4:                                    â”‚
â”‚  {                                                                â”‚
â”‚    "sections": [...],                                             â”‚
â”‚    "section_roles": [...],                                        â”‚
â”‚    "locked_terms": [...]                                          â”‚
â”‚  }                                                                â”‚
â”‚       â†“                                                           â”‚
â”‚  Step 3.0 â†’ paragraphs[] + paragraph_section_map                  â”‚
â”‚       â†“                                                           â”‚
â”‚  Step 3.1 (åŸºäºparagraphs) â†’ paragraph_roles[]                    â”‚
â”‚       â†“                                                           â”‚
â”‚  Step 3.2 (åŸºäºparagraphs) â†’ coherence_scores[]                   â”‚
â”‚       â†“                                                           â”‚
â”‚  Step 3.3 (åŸºäºparagraphs) â†’ anchor_densities[]                   â”‚
â”‚       â†“                                                           â”‚
â”‚  Step 3.4 (åŸºäºparagraphs) â†’ sentence_length_cvs[]                â”‚
â”‚       â†“                                                           â”‚
â”‚  Step 3.5 (åŸºäºparagraphs) â†’ transition_issues[]                  â”‚
â”‚       â†“                                                           â”‚
â”‚  ä¼ é€’ç»™ Layer 2 Pass to Layer 2:                                  â”‚
â”‚  {                                                                â”‚
â”‚    "paragraphs": [...],                                           â”‚
â”‚    "paragraph_roles": [...],                                      â”‚
â”‚    "paragraph_coherence": [...],                                  â”‚
â”‚    "paragraph_anchor_density": [...],                             â”‚
â”‚    "paragraph_sentence_lengths": [...],                           â”‚
â”‚    "locked_terms": [...]                                          â”‚
â”‚  }                                                                â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€ä¸Layer 5/Layer 4çš„å¯¹æ¯” | Comparison with Layer 5/Layer 4

### 7.1 è®¾è®¡æ¨¡å¼å¯¹æ¯” | Design Pattern Comparison

| å±‚çº§ Layer | åŸºç¡€æ­¥éª¤ (X.0) | ä¸»è¦æ­¥éª¤ | å…³æ³¨ç‚¹ Focus |
|-----------|---------------|---------|-------------|
| **Layer 5** | 1.0 è¯æ±‡é”å®š | 1.1-1.5 | å…¨æ–‡ç»“æ„ã€ç« èŠ‚é¡ºåºã€æ®µè½é•¿åº¦ã€è¿æ¥è¯ |
| **Layer 4** | 2.0 ç« èŠ‚è¯†åˆ« | 2.1-2.5 | ç« èŠ‚é¡ºåºã€é•¿åº¦åˆ†å¸ƒã€ç›¸ä¼¼æ€§ã€è¿‡æ¸¡ã€é€»è¾‘ |
| **Layer 3** | 3.0 æ®µè½è¯†åˆ« | 3.1-3.5 | æ®µè½è§’è‰²ã€è¿è´¯æ€§ã€é”šç‚¹ã€å¥é•¿ã€è¿‡æ¸¡ |

### 7.2 æ­¥éª¤æ•°é‡å¯¹æ¯” | Step Count Comparison

| Layer | æ­¥éª¤æ•° | æ­¥éª¤ç¼–å· |
|-------|-------|---------|
| Layer 5 | 6 | 1.0, 1.1, 1.2, 1.3, 1.4, 1.5 |
| Layer 4 | 6 | 2.0, 2.1, 2.2, 2.3, 2.4, 2.5 |
| Layer 3 | 6 | 3.0, 3.1, 3.2, 3.3, 3.4, 3.5 |

---

## å…«ã€å®ç°ä¼˜å…ˆçº§ | Implementation Priority

| ä¼˜å…ˆçº§ Priority | å­æ­¥éª¤ Sub-Step | åŸå›  Reason |
|----------------|----------------|-------------|
| **P0** | Step 3.0 æ®µè½è¯†åˆ« | åŸºç¡€æ­¥éª¤ï¼Œæ‰€æœ‰åç»­æ­¥éª¤ä¾èµ– |
| **P1** | Step 3.2 å†…éƒ¨è¿è´¯æ€§ | ParagraphLogicAnalyzerå·²æœ‰ï¼Œç”¨æˆ·æ„ŸçŸ¥å¼º |
| **P1** | Step 3.3 é”šç‚¹å¯†åº¦ | AnchorDensityAnalyzerå·²æœ‰ï¼Œæ£€æµ‹AIå¡«å……ç‰© |
| **P2** | Step 3.4 å¥é•¿åˆ†å¸ƒ | ç»Ÿè®¡è®¡ç®—ç®€å•ï¼Œæœ‰ç°æˆBurstinessAnalyzer |
| **P2** | Step 3.1 æ®µè½è§’è‰² | éœ€è¦LLMæ”¯æŒï¼Œä½†å¯ç”¨è§„åˆ™ä½œä¸ºåŸºç¡€ |
| **P3** | Step 3.5 è¿‡æ¸¡æ£€æµ‹ | TransitionAnalyzerå·²æœ‰ï¼Œéœ€è¦å‰ç«¯é€‚é… |

---

## ä¹ã€å‰ç«¯ç»„ä»¶è®¾è®¡ | Frontend Component Design

### 9.1 ç»„ä»¶æ–‡ä»¶è§„åˆ’ | Component Files

```
frontend/src/pages/layers/
â”œâ”€â”€ LayerStep3_0.tsx    # æ®µè½è¯†åˆ«ä¸åˆ†å‰²
â”œâ”€â”€ LayerStep3_1.tsx    # æ®µè½è§’è‰²è¯†åˆ«
â”œâ”€â”€ LayerStep3_2.tsx    # å†…éƒ¨è¿è´¯æ€§æ£€æµ‹
â”œâ”€â”€ LayerStep3_3.tsx    # é”šç‚¹å¯†åº¦åˆ†æ
â”œâ”€â”€ LayerStep3_4.tsx    # å¥é•¿åˆ†å¸ƒåˆ†æ
â””â”€â”€ LayerStep3_5.tsx    # æ®µè½é—´è¿‡æ¸¡æ£€æµ‹
```

### 9.2 å…±äº«ç»„ä»¶ | Shared Components

```
frontend/src/components/layers/
â”œâ”€â”€ ParagraphCard.tsx           # æ®µè½å¡ç‰‡å±•ç¤º
â”œâ”€â”€ CoherenceMatrix.tsx         # è¿è´¯æ€§æŒ‡æ ‡çŸ©é˜µ
â”œâ”€â”€ AnchorDensityChart.tsx      # é”šç‚¹å¯†åº¦å›¾è¡¨
â”œâ”€â”€ SentenceLengthBar.tsx       # å¥é•¿å¯è§†åŒ–æ¡
â”œâ”€â”€ TransitionLine.tsx          # è¿‡æ¸¡çº¿æŒ‡ç¤ºå™¨
â””â”€â”€ IssueHighlighter.tsx        # é—®é¢˜é«˜äº®ç»„ä»¶
```

---

## åã€æ€»ç»“ | Summary

æœ¬è®¾è®¡å°†Layer 3çš„æ®µè½çº§æ£€æµ‹æ•´åˆä¸º**6ä¸ªæœ‰åºçš„å­æ­¥éª¤**ï¼š

0. **Step 3.0 æ®µè½è¯†åˆ«ä¸åˆ†å‰²** - æ¥æ”¶Sectionä¸Šä¸‹æ–‡ï¼Œæ­£ç¡®è¯†åˆ«å’Œåˆ†å‰²æ®µè½
1. **Step 3.1 æ®µè½è§’è‰²è¯†åˆ«** - è¯†åˆ«æ¯ä¸ªæ®µè½çš„åŠŸèƒ½è§’è‰²ï¼Œæ£€æµ‹è§’è‰²åˆ†å¸ƒå¼‚å¸¸
2. **Step 3.2 å†…éƒ¨è¿è´¯æ€§æ£€æµ‹** - æ£€æµ‹æ®µè½å†…å¥å­çš„é€»è¾‘å…³ç³»ï¼Œè¯†åˆ«AIå¼çº¿æ€§ç»“æ„
3. **Step 3.3 é”šç‚¹å¯†åº¦åˆ†æ** - æ£€æµ‹å­¦æœ¯é”šç‚¹å¯†åº¦ï¼Œè¯†åˆ«AIå¡«å……ç‰©ï¼ˆå¹»è§‰é£é™©ï¼‰
4. **Step 3.4 å¥é•¿åˆ†å¸ƒåˆ†æ** - åˆ†ææ®µå†…å¥å­é•¿åº¦å˜åŒ–ï¼Œæ£€æµ‹å‡åŒ€å¥é•¿æ¨¡å¼
5. **Step 3.5 è¿‡æ¸¡æ£€æµ‹** - æ£€æµ‹æ®µè½é—´è¿‡æ¸¡è´¨é‡ï¼Œæä¾›è¯­ä¹‰æ¡¥æ¥å»ºè®®

æ¯ä¸ªå­æ­¥éª¤éµå¾ªï¼š**æ£€æµ‹ â†’ å±•ç¤ºé—®é¢˜ â†’ ç”¨æˆ·é€‰æ‹©è§¦å‘AIåˆ†æ â†’ æä¾›å»ºè®® â†’ ç”¨æˆ·å†³ç­– â†’ ä¼ é€’ç»™ä¸‹ä¸€æ­¥** çš„äº¤äº’æ¨¡å¼ã€‚

è¿™ç§è®¾è®¡ç¡®ä¿äº†ï¼š
- **ä¸Šä¸‹æ–‡ä¼ é€’**ï¼ˆä»Layer 4æ¥æ”¶ç« èŠ‚ä¿¡æ¯ï¼Œå‘Layer 2ä¼ é€’æ®µè½ä¿¡æ¯ï¼‰
- **æ£€æµ‹çš„å…¨é¢æ€§**ï¼ˆæ•´åˆæ‰€æœ‰å·²æœ‰å’Œå¾…é›†æˆçš„æ£€æµ‹å™¨ï¼‰
- **å¤„ç†çš„æœ‰åºæ€§**ï¼ˆä»æ®µè½è¯†åˆ«åˆ°è¿‡æ¸¡æ£€æµ‹ï¼‰
- **ç”¨æˆ·ä½“éªŒçš„å‹å¥½æ€§**ï¼ˆæ¸…æ™°çš„é—®é¢˜å±•ç¤ºå’ŒAIè¾…åŠ©å»ºè®®ï¼‰
- **æŠ€æœ¯å®ç°çš„å¯è¡Œæ€§**ï¼ˆåŸºäºç°æœ‰ä»£ç æ¶æ„ï¼‰

---

> æ–‡æ¡£ç»´æŠ¤ Document Maintenance:
> æœ¬æ–‡æ¡£ä¸ºLayer 3å­æ­¥éª¤ç³»ç»Ÿçš„å”¯ä¸€è®¾è®¡æ–‡æ¡£ï¼Œæ‰€æœ‰ç›¸å…³å˜æ›´éœ€åŒæ­¥æ›´æ–°æ­¤æ–‡ä»¶ã€‚
> This is the sole design document for Layer 3 sub-step system. All related changes must be synced here.
